<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Spenser Jones]]></title>
  <link href="http://spenserj.com/atom.xml" rel="self"/>
  <link href="http://spenserj.com/"/>
  <updated>2013-07-24T17:12:20-06:00</updated>
  <id>http://spenserj.com/</id>
  <author>
    <name><![CDATA[Spenser Jones]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Prevent Server Version Leaks in MediaWiki's Special:Version]]></title>
    <link href="http://spenserj.com/blog/2013/07/19/prevent-server-version-leaks-in-mediawikis-special-version/"/>
    <updated>2013-07-19T16:34:00-06:00</updated>
    <id>http://spenserj.com/blog/2013/07/19/prevent-server-version-leaks-in-mediawikis-special-version</id>
    <content type="html"><![CDATA[<p>Setting up a knowledge base or wiki is a great way of keeping people (coworkers, clients, strangers, and anyone else you can think of) informed about certain topics, and MediaWiki is one of the most popular choices for this. It powers Wikipedia, the <a href="https://en.wikipedia.org/wiki/Wikipedia">worlds largest general reference work</a>, and thousands of other wikis on a variety of subjects.</p>

<p>While obscuring version information should never be your only form of security, it makes life slightly harder for anyone looking to vandalize or penetrate your webserver. By default, MediaWiki will tell anyone who will listen what software you&rsquo;re running (<a href="https://www.mediawiki.org/wiki/Special:Version">example</a>), and there is no obvious way of disabling this. The solution? Let&rsquo;s dig into the code behind this page, and cut it off at the source.</p>

<!-- more -->


<p>Open up <code>includes/specials/SpecialVersion.php</code>, and locate the <code>execute</code> function (somewhere around line 50). You&rsquo;ll find a variable called <code>$text</code> that will contain all of the information to be displayed, and one of the functions it calls is <code>softwareInformation()</code>. If you comment out the entire line and save the file, you&rsquo;ll plug MediaWiki&rsquo;s version leak.</p>

<figure class='code'><figcaption><span>includes/specials/SpecialVersion.php - SpecialVersion->execute</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">execute</span><span class="p">(</span> <span class="nv">$par</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">global</span> <span class="nv">$wgSpecialVersionShowHooks</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setHeaders</span><span class="p">();</span>
</span><span class='line'>  <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">outputHeader</span><span class="p">();</span>
</span><span class='line'>  <span class="nv">$out</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getOutput</span><span class="p">();</span>
</span><span class='line'>  <span class="nv">$out</span><span class="o">-&gt;</span><span class="na">allowClickjacking</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$text</span> <span class="o">=</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMediaWikiCredits</span><span class="p">()</span> <span class="o">.</span>
</span><span class='line'>    <span class="c1">// Commented out to stop the version leak</span>
</span><span class='line'>    <span class="c1">// $this-&gt;softwareInformation() .</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getEntryPointInfo</span><span class="p">()</span> <span class="o">.</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getExtensionCredits</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Kill it with fire</h2>

<p>If removing your software version doesn&rsquo;t leave you feeling satisfied, you can remove the page entirely by commenting out a line in <code>includes/SpecialPageFactory.php</code>. I&rsquo;m not a fan of this extreme step, as it removes recognition for the developers, licensing information, and a list of the extensions you&rsquo;re using, none of which are a security risk.</p>

<figure class='code'><figcaption><span>includes/SpecialPageFactory.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="c1">// Wiki data and tools</span>
</span><span class='line'><span class="s1">&#39;Statistics&#39;</span>                <span class="o">=&gt;</span> <span class="s1">&#39;SpecialStatistics&#39;</span><span class="p">,</span>
</span><span class='line'><span class="s1">&#39;Allmessages&#39;</span>               <span class="o">=&gt;</span> <span class="s1">&#39;SpecialAllmessages&#39;</span><span class="p">,</span>
</span><span class='line'><span class="c1">// Commented out to remove the Special:Version page entirely</span>
</span><span class='line'><span class="c1">// &#39;Version&#39;                   =&gt; &#39;SpecialVersion&#39;,</span>
</span><span class='line'><span class="s1">&#39;Lockdb&#39;</span>                    <span class="o">=&gt;</span> <span class="s1">&#39;SpecialLockdb&#39;</span><span class="p">,</span>
</span><span class='line'><span class="s1">&#39;Unlockdb&#39;</span>                  <span class="o">=&gt;</span> <span class="s1">&#39;SpecialUnlockdb&#39;</span><span class="p">,</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Securing a Linux Server]]></title>
    <link href="http://spenserj.com/blog/2013/07/15/securing-a-linux-server/"/>
    <updated>2013-07-15T10:52:00-06:00</updated>
    <id>http://spenserj.com/blog/2013/07/15/securing-a-linux-server</id>
    <content type="html"><![CDATA[<p>It is a rare to watch someone secure a freshly installed server right off the bat, yet the world we live in makes this a necessity. So why do so many people put it off until the end, if at all? I&rsquo;ve done the exact same thing, and it often comes down to wanting to get right into the fun stuff. Hopefully this post will show that it is far easier than you think to secure a server, and can be quite entertaining to look down from your fortress, when the attacks begin to flow.</p>

<p>This post is written for Ubuntu 12.04.2 LTS, however you can do similar things on any other Linux distribution.</p>

<!-- more -->


<h2>Where do I begin?</h2>

<p>If this server already has a public IP, you&rsquo;ll want to lock down root access immediately. In fact, you&rsquo;ll want to lock down SSH access entirely, and make sure that only <em>you</em> can get in. Add a new user, and add it to an admin group (preconfigured in <code>/etc/sudoers</code> to have access to <code>sudo</code>).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo addgroup admin
</span><span class='line'>Adding group 'admin' (GID 1001)
</span><span class='line'>Done.
</span><span class='line'>
</span><span class='line'>$ sudo adduser spenserj
</span><span class='line'>Adding user `spenserj' ...
</span><span class='line'>Adding new group `spenserj' (1002) ...
</span><span class='line'>Adding new user `spenserj' (1001) with group `spenserj' ...
</span><span class='line'>Creating home directory `/home/spenserj' ...
</span><span class='line'>Copying files from `/etc/skel' ...
</span><span class='line'>Enter new UNIX password:
</span><span class='line'>Retype new UNIX password:
</span><span class='line'>passwd: password updated successfully
</span><span class='line'>Changing the user information for spenserj
</span><span class='line'>Enter the new value, or press ENTER for the default
</span><span class='line'>    Full Name []: Spenser Jones
</span><span class='line'>    Room Number []:
</span><span class='line'>    Work Phone []:
</span><span class='line'>    Home Phone []:
</span><span class='line'>    Other []:
</span><span class='line'>Is the information correct? [Y/n] y
</span><span class='line'>
</span><span class='line'>$ sudo usermod -a -G admin spenserj</span></code></pre></td></tr></table></div></figure>


<p>You’ll also want to create a private key on your computer, and disable that pesky password authentication on the server.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir ~/.ssh
</span><span class='line'>$ echo "ssh-rsa [your public key]" &gt; ~/.ssh/authorized_keys</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>/etc/ssh/sshd_config</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PermitRootLogin no
</span><span class='line'>PermitEmptyPasswords no
</span><span class='line'>PasswordAuthentication no
</span><span class='line'>AllowUsers spenserj</span></code></pre></td></tr></table></div></figure>


<p>Reload SSH to apply the changes, and then try logging in <strong>in a new session</strong> to ensure everything worked. If you can&rsquo;t log in, you&rsquo;ll still have your original session to fix things up.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo service ssh restart
</span><span class='line'>ssh stop/waiting
</span><span class='line'>ssh start/running, process 1599</span></code></pre></td></tr></table></div></figure>


<h2>Update the server</h2>

<p>Now that you&rsquo;re the only one with access to the server, you can stop worrying about a hacker sneaking in, and breathe normally again. Chances are good that there are some updates for your server, so go ahead and run those now.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get update
</span><span class='line'>...
</span><span class='line'>Hit http://ca.archive.ubuntu.com precise-updates/universe Translation-en_CA
</span><span class='line'>Hit http://ca.archive.ubuntu.com precise-updates/universe Translation-en
</span><span class='line'>Hit http://ca.archive.ubuntu.com precise-backports/main Translation-en
</span><span class='line'>Hit http://ca.archive.ubuntu.com precise-backports/multiverse Translation-en
</span><span class='line'>Hit http://ca.archive.ubuntu.com precise-backports/restricted Translation-en
</span><span class='line'>Hit http://ca.archive.ubuntu.com precise-backports/universe Translation-en
</span><span class='line'>Fetched 3,285 kB in 5s (573 kB/s)
</span><span class='line'>Reading package lists... Done
</span><span class='line'>
</span><span class='line'>$ sudo apt-get upgrade
</span><span class='line'>Reading package lists... Done
</span><span class='line'>Building dependency tree
</span><span class='line'>Reading state information... Done
</span><span class='line'>The following packages have been kept back:
</span><span class='line'>  linux-headers-generic-lts-quantal linux-image-generic-lts-quantal
</span><span class='line'>The following packages will be upgraded:
</span><span class='line'>  accountsservice apport apt apt-transport-https apt-utils aptitude bash ...
</span><span class='line'>73 upgraded, 0 newly installed, 0 to remove and 2 not upgraded.
</span><span class='line'>Need to get 61.0 MB of archives.
</span><span class='line'>After this operation, 151 kB of additional disk space will be used.
</span><span class='line'>Do you want to continue [Y/n]? Y
</span><span class='line'>...
</span><span class='line'>Setting up libisc83 (1:9.8.1.dfsg.P1-4ubuntu0.6) ...
</span><span class='line'>Setting up libdns81 (1:9.8.1.dfsg.P1-4ubuntu0.6) ...
</span><span class='line'>Setting up libisccc80 (1:9.8.1.dfsg.P1-4ubuntu0.6) ...
</span><span class='line'>Setting up libisccfg82 (1:9.8.1.dfsg.P1-4ubuntu0.6) ...
</span><span class='line'>Setting up libbind9-80 (1:9.8.1.dfsg.P1-4ubuntu0.6) ...
</span><span class='line'>Setting up liblwres80 (1:9.8.1.dfsg.P1-4ubuntu0.6) ...
</span><span class='line'>Setting up bind9-host (1:9.8.1.dfsg.P1-4ubuntu0.6) ...
</span><span class='line'>Setting up dnsutils (1:9.8.1.dfsg.P1-4ubuntu0.6) ...
</span><span class='line'>Setting up iptables (1.4.12-1ubuntu5) ...
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<h2>Install a Firewall</h2>

<p>Running the most recent software now? Good. Go ahead and set up a firewall, and <em>only</em> allow what you need right at this moment. You can always add another exception later, and a few minutes of extra work won&rsquo;t kill you. IPTables comes preinstalled in Ubuntu, so go ahead and set up some rules for it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo mkdir /etc/iptables</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>/etc/iptables/rules</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>*filter
</span><span class='line'>:INPUT DROP [0:0]
</span><span class='line'>:FORWARD DROP [0:0]
</span><span class='line'>:OUTPUT DROP [0:0]
</span><span class='line'>
</span><span class='line'># Accept any related or established connections
</span><span class='line'>-I INPUT  1 -m state --state RELATED,ESTABLISHED -j ACCEPT
</span><span class='line'>-I OUTPUT 1 -m state --state RELATED,ESTABLISHED -j ACCEPT
</span><span class='line'>
</span><span class='line'># Allow all traffic on the loopback interface
</span><span class='line'>-A INPUT  -i lo -j ACCEPT
</span><span class='line'>-A OUTPUT -o lo -j ACCEPT
</span><span class='line'>
</span><span class='line'># Allow outbound DHCP request - Some hosts (Linode) automatically assign the primary IP
</span><span class='line'>#-A OUTPUT -p udp --dport 67:68 --sport 67:68 -j ACCEPT
</span><span class='line'>
</span><span class='line'># Outbound DNS lookups
</span><span class='line'>-A OUTPUT -o eth0 -p udp -m udp --dport 53 -j ACCEPT
</span><span class='line'>
</span><span class='line'># Outbound PING requests
</span><span class='line'>-A OUTPUT -p icmp -j ACCEPT
</span><span class='line'>
</span><span class='line'># Outbound Network Time Protocol (NTP) request
</span><span class='line'>-A OUTPUT -p udp --dport 123 --sport 123 -j ACCEPT
</span><span class='line'>
</span><span class='line'># SSH
</span><span class='line'>-A INPUT  -i eth0 -p tcp -m tcp --dport 22 -m state --state NEW -j ACCEPT
</span><span class='line'>
</span><span class='line'># Outbound HTTP
</span><span class='line'>-A OUTPUT -o eth0 -p tcp -m tcp --dport 80 -m state --state NEW -j ACCEPT
</span><span class='line'>-A OUTPUT -o eth0 -p tcp -m tcp --dport 443 -m state --state NEW -j ACCEPT
</span><span class='line'>
</span><span class='line'>COMMIT</span></code></pre></td></tr></table></div></figure>


<p>Apply the ruleset with a timeout through <code>iptables-apply</code>, and if you lose the connection, fix your rules and try again before continuing.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo iptables-apply /etc/iptables/rules
</span><span class='line'>Applying new ruleset... done.
</span><span class='line'>Can you establish NEW connections to the machine? (y/N) y
</span><span class='line'>... then my job is done. See you next time.</span></code></pre></td></tr></table></div></figure>


<p>Create the file <code>/etc/network/if-pre-up.d/iptables</code>, with the following content. This will automatically load your IPTables rules when you start the server.</p>

<figure class='code'><figcaption><span>/etc/network/if-pre-up.d/iptables</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#!/bin/sh
</span><span class='line'>iptables-restore &lt; /etc/iptables/rules</span></code></pre></td></tr></table></div></figure>


<p>Now give it execute permissions, and execute the file to ensure it loads properly.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo chmod +x /etc/network/if-pre-up.d/iptables
</span><span class='line'>$ sudo /etc/network/if-pre-up.d/iptables</span></code></pre></td></tr></table></div></figure>


<h2>Fail2ban those wannabe-hackers</h2>

<p>Fail2ban is one of my favourite tools when it comes to security, as it will monitor your logfiles, and temporarily ban users that are misusing your resources, be it brute forcing your SSH connection, or DoSing your webserver.</p>

<figure class='code'><figcaption><span>Install Fail2ban</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install fail2ban
</span><span class='line'>[sudo] password for sjones:
</span><span class='line'>Reading package lists... Done
</span><span class='line'>Building dependency tree
</span><span class='line'>Reading state information... Done
</span><span class='line'>The following extra packages will be installed:
</span><span class='line'>  gamin libgamin0 python-central python-gamin python-support whois
</span><span class='line'>Suggested packages:
</span><span class='line'>  mailx
</span><span class='line'>The following NEW packages will be installed:
</span><span class='line'>  fail2ban gamin libgamin0 python-central python-gamin python-support whois
</span><span class='line'>0 upgraded, 7 newly installed, 0 to remove and 2 not upgraded.
</span><span class='line'>Need to get 254 kB of archives.
</span><span class='line'>After this operation, 1,381 kB of additional disk space will be used.
</span><span class='line'>Do you want to continue [Y/n]? y
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<p>Fail2ban installs a default configuration (<code>/etc/fail2ban/jail.conf</code>), but we&rsquo;ll want to make our changes in <code>/etc/fail2ban/jail.local</code>, so copy it there.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo cp /etc/fail2ban/jail.{conf,local}</span></code></pre></td></tr></table></div></figure>


<h3>Configuration</h3>

<p>Change the <code>ignoreip</code> line to your IP, and decide on an amount of time to ban the scumbags for (default is 10 minutes). You&rsquo;ll also want to set up a <code>destemail</code>, which I normally enter as my own email address followed by <code>,fail2ban@blocklist.de</code>. <a href="http://www.blocklist.de/">BlockList.de</a> is a system to track and automatically report hacking attempts to the proper abuse contact for their IP.</p>

<figure class='code'><figcaption><span>/etc/fail2ban/jail.local</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[DEFAULT]
</span><span class='line'>
</span><span class='line'># "ignoreip" can be an IP address, a CIDR mask or a DNS host
</span><span class='line'>ignoreip = 127.0.0.1/8
</span><span class='line'>bantime  = 600
</span><span class='line'>maxretry = 3
</span><span class='line'>
</span><span class='line'># "backend" specifies the backend used to get files modification. Available
</span><span class='line'># options are "gamin", "polling" and "auto".
</span><span class='line'># yoh: For some reason Debian shipped python-gamin didn't work as expected
</span><span class='line'>#      This issue left ToDo, so polling is default backend for now
</span><span class='line'>backend = auto
</span><span class='line'>
</span><span class='line'>#
</span><span class='line'># Destination email address used solely for the interpolations in
</span><span class='line'># jail.{conf,local} configuration files.
</span><span class='line'>destemail = root@localhost,fail2ban@blocklist.de</span></code></pre></td></tr></table></div></figure>


<p>There are a few other settings you&rsquo;ll want to check out, although the defaults are quite sufficient, so skim through the file quickly until you reach the Actions section.</p>

<h3>Actions</h3>

<p>Actions allow you to react to malicious activity, however the default is to issue an IPTables ban, while we want it to ban <em>and</em> send an email. Thankfully there is a preconfigured <code>action_wml</code>, which does just that.</p>

<figure class='code'><figcaption><span>/etc/fail2ban/jail.local</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Choose default action.  To change, just override value of 'action' with the
</span><span class='line'># interpolation to the chosen action shortcut (e.g.  action_mw, action_mwl, etc) in jail.local
</span><span class='line'># globally (section [DEFAULT]) or per specific section
</span><span class='line'>action = %(action_mwl)s</span></code></pre></td></tr></table></div></figure>


<h3>Jails</h3>

<p>In order for Fail2ban to work, it needs to know what to watch. These are configured in the Jails section of the config, and there are quite a few examples pre-loaded and disabled. Since you&rsquo;ve only enabled SSH access on the server so far, we&rsquo;ll only enable the SSH and SSH-DDoS jails, however you&rsquo;ll want to add a new jail for each publicly-accessible service that you install on this server.</p>

<figure class='code'><figcaption><span>/etc/fail2ban/jail.local</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ssh]
</span><span class='line'>
</span><span class='line'>enabled  = true
</span><span class='line'>port     = ssh
</span><span class='line'>filter   = sshd
</span><span class='line'>logpath  = /var/log/auth.log
</span><span class='line'>maxretry = 6
</span><span class='line'>
</span><span class='line'>[ssh-ddos]
</span><span class='line'>
</span><span class='line'>enabled  = true
</span><span class='line'>port     = ssh
</span><span class='line'>filter   = sshd-ddos
</span><span class='line'>logpath  = /var/log/auth.log
</span><span class='line'>maxretry = 6</span></code></pre></td></tr></table></div></figure>


<h3>Apply the changes</h3>

<p>Now that we&rsquo;ve configured Fail2ban, you&rsquo;ll want to reload it, and confirm that it is adding the appropriate rules to IPTables.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo service fail2ban restart
</span><span class='line'> * Restarting authentication failure monitor fail2ban
</span><span class='line'>   ...done.
</span><span class='line'>
</span><span class='line'>$ sudo iptables -L
</span><span class='line'>Chain INPUT (policy DROP)
</span><span class='line'>target     prot opt source               destination
</span><span class='line'>fail2ban-ssh-ddos  tcp  --  anywhere             anywhere             multiport dports ssh
</span><span class='line'>fail2ban-ssh  tcp  --  anywhere             anywhere             multiport dports ssh
</span><span class='line'>...
</span><span class='line'>Chain fail2ban-ssh (1 references)
</span><span class='line'>target     prot opt source               destination
</span><span class='line'>RETURN     all  --  anywhere             anywhere
</span><span class='line'>
</span><span class='line'>Chain fail2ban-ssh-ddos (1 references)
</span><span class='line'>target     prot opt source               destination
</span><span class='line'>RETURN     all  --  anywhere             anywhere</span></code></pre></td></tr></table></div></figure>


<p>At any time, you can use <code>sudo iptables -L</code> to list your rules, and subsequently list any currently-banned IPs. At the moment, Fail2ban is handling two malicious individuals:</p>

<figure class='code'><figcaption><span>Banned IPs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>DROP       all  --  204.50.33.22         anywhere
</span><span class='line'>DROP       all  --  195.128.126.114      anywhere</span></code></pre></td></tr></table></div></figure>


<h2>Staying on top of things</h2>

<p>You should now have a server that is locked down and ready to use, however this is not the end of your security journey. Stay on top of updates (and always test them in a non-production environment first), always close ports that you don&rsquo;t need, check your logs regularly, and know your servers inside-and-out.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Setting up NSD3 for DNS]]></title>
    <link href="http://spenserj.com/blog/2013/07/12/setting-up-nsd3-for-dns/"/>
    <updated>2013-07-12T11:31:00-06:00</updated>
    <id>http://spenserj.com/blog/2013/07/12/setting-up-nsd3-for-dns</id>
    <content type="html"><![CDATA[<p>There are two major players in the Domain Name System server market: <a href="https://www.isc.org/downloads/bind/">Bind</a> and <a href="https://www.nlnetlabs.nl/projects/nsd/">NSD</a>. The former has been around since the 1980s and makes up a majority of the installations in use today, while the latter saw its first release around the turn of the century, and is designed to be purely authoritative (incapable of recursive DNS queries). While selecting a DNS server for <a href="https://ambrose.edu">Ambrose University College</a>, NSD&rsquo;s ability to easily run from a Chroot, and its lightweight footprint (currently using 69MB of RAM for the entire server), easily won our vote. Furthermore, NSD can make use of BIND&rsquo;s zonefiles, and the migration from our old server was complete in a matter of minutes.</p>

<!-- more -->


<h2>Securing your server</h2>

<p>Before you even consider working on your DNS server, you&rsquo;ll want to lock down your security. What good is a server if you can&rsquo;t trust it? I&rsquo;ve written up a separate post on <a href="http://spenserj.com/blog/2013/07/15/securing-a-linux-server/">Securing a Linux Server</a> that should give you a head start.</p>

<h2>Install NSD</h2>

<p>NSD will start as soon as you install it, and complain if you don&rsquo;t have a config file created already, so we&rsquo;ll create a blank file for now.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo mkdir /etc/nsd3
</span><span class='line'>$ sudo touch /etc/nsd3/nsd.conf
</span><span class='line'>$ sudo apt-get install nsd3
</span><span class='line'>Reading package lists... Done
</span><span class='line'>Building dependency tree
</span><span class='line'>Reading state information... Done
</span><span class='line'>The following NEW packages will be installed:
</span><span class='line'>  nsd3
</span><span class='line'>0 upgraded, 1 newly installed, 0 to remove and 2 not upgraded.
</span><span class='line'>Need to get 931 kB of archives.
</span><span class='line'>After this operation, 1,672 kB of additional disk space will be used.
</span><span class='line'>Get:1 http://ca.archive.ubuntu.com/ubuntu/ precise/universe nsd3 amd64 3.2.9-1 [931 kB]
</span><span class='line'>Fetched 931 kB in 1s (491 kB/s)
</span><span class='line'>Selecting previously unselected package nsd3.
</span><span class='line'>(Reading database ... 49711 files and directories currently installed.)
</span><span class='line'>Unpacking nsd3 (from .../nsd3_3.2.9-1_amd64.deb) ...
</span><span class='line'>Processing triggers for ureadahead ...
</span><span class='line'>Processing triggers for man-db ...
</span><span class='line'>Setting up nsd3 (3.2.9-1) ...
</span><span class='line'>grep: /etc/aliases: No such file or directory
</span><span class='line'> * Building nsd3 zones... [ OK ]
</span><span class='line'> * Starting nsd3...       [ OK ]</span></code></pre></td></tr></table></div></figure>


<h3>Give yourself access to <code>/etc/nsd3</code></h3>

<p>By default, you won&rsquo;t have access to <code>/etc/nsd3</code> without working as root, and running as root is bad form, so let&rsquo;s add the nsd group to our account. We probably have some kernel updates that need to be applied, and we need to relogin for the group to apply, so this is the perfect time to reboot our server as well.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo usermod -a -G nsd spenserj
</span><span class='line'>$ sudo reboot now
</span><span class='line'>Broadcast message from spenserj@dnsmaster
</span><span class='line'>    (/dev/pts/0) at 17:23 ...
</span><span class='line'>
</span><span class='line'>The system is going down for reboot NOW!</span></code></pre></td></tr></table></div></figure>


<h2>Configure NSD</h2>

<h3>Configure NSD as a Master</h3>

<p>You&rsquo;ll find a sample configuration at <code>/etc/nsd3/nsd.conf.sample</code>, and <a href="http://linux.die.net/man/5/nsd.conf">man nsd.conf</a> is a great place to find more information. The config is quite simplistic though, and I was un and running in minutes.</p>

<figure class='code'><figcaption><span>/etc/nsd3/nsd.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>server:
</span><span class='line'>  logfile: "/var/log/nsd.log"
</span><span class='line'>  username: nsd
</span><span class='line'>  hide-version: yes
</span><span class='line'>  identity: "ns1.ambrose.edu"
</span><span class='line'>
</span><span class='line'># Primary ambrose.edu Forward Lookup Zone
</span><span class='line'>zone:
</span><span class='line'>  name: ambrose.edu
</span><span class='line'>  zonefile: forward/ambrose.edu.zone
</span><span class='line'>
</span><span class='line'>  notify:      dnsslave1 NOKEY
</span><span class='line'>  provide-xfr: dnsslave1 NOKEY
</span><span class='line'>
</span><span class='line'>  notify:      dnsslave2 slave2key
</span><span class='line'>  provide-xfr: dnsslave2 slave2key
</span><span class='line'>
</span><span class='line'># Shaw Reverse Lookup Zone
</span><span class='line'>zone:
</span><span class='line'>  name: 237.244.66.in-addr.arpa
</span><span class='line'>  zonefile: reverse/66.244.237.zone
</span><span class='line'>
</span><span class='line'>  notify:      dnsslave1 NOKEY
</span><span class='line'>  provide-xfr: dnsslave1 NOKEY
</span><span class='line'>
</span><span class='line'>  notify:      dnsslave2 slave2key
</span><span class='line'>  provide-xfr: dnsslave2 slave2key
</span><span class='line'>
</span><span class='line'>key:
</span><span class='line'>  name: slave2key
</span><span class='line'>  algorithm: hmac-md5
</span><span class='line'>  secret: "95hP9OTvHID2jJO2GNaeuw=="</span></code></pre></td></tr></table></div></figure>


<p>You may be asking yourself &ldquo;But Spenser, how do I generate that key?&rdquo;, and thankfully the answer is quite simple.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ dd if=/dev/random bs=16 count=1 2&gt;/dev/null | openssl base64
</span><span class='line'>NzmiUkU7zA/2rQ6nnjut3w==</span></code></pre></td></tr></table></div></figure>


<h3>Configure NSD as a Slave</h3>

<p>The slave configuration is nearly identical to the master, with the only change being the <code>notify</code> and <code>provide-xfr</code> lines changing to the slave-variant. Each zone is required to have a zonefile, but you don&rsquo;t need to fill it out if it pulls from the master, so I just touched each file and left it empty.</p>

<figure class='code'><figcaption><span>/etc/nsd3/nsd.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>zone:
</span><span class='line'>  name: ambrose.edu
</span><span class='line'>  zonefile: forward/ambrose.edu.zone
</span><span class='line'>
</span><span class='line'>  allow-notify:      dnsmaster NOKEY
</span><span class='line'>  request-xfr:  AXFR dnsmaster NOKEY</span></code></pre></td></tr></table></div></figure>


<h3>Zonefiles</h3>

<p>NSD uses BIND zonefiles, and there is a plethora of documentation and guides on how to write one, so hit up your favourite search engine and you&rsquo;ll be on your way. Don&rsquo;t forget to update the SOA Serial whenever you make a change, otherwise the next step won&rsquo;t work.</p>

<h3>Applying your configuration changes</h3>

<p>If you&rsquo;ve modified your <code>nsd.conf</code>, you&rsquo;ll need to restart NSD.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo nsdc restart</span></code></pre></td></tr></table></div></figure>


<p>Otherwise, changes to zonefiles require the zone database to be rebuilt and reloaded.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo nsdc rebuild
</span><span class='line'>$ sudo nsdc reload</span></code></pre></td></tr></table></div></figure>


<p>If you have any slaves configured, be sure to check your logs for errors. If you don&rsquo;t set the server verbosity to 1 (incoming notifies/transfers) or 2 (soft warnings), and don&rsquo;t receive an error, it is likely working.</p>

<h2>Confirming your Master/Slave zones</h2>

<p>Dig is a wonderful tool when testing DNS changes. Check the forward and reverse zones of each of your nameservers, and make sure the serial and information matches. Then update the serial on your master, rebuild/reload, and check the slave again.</p>

<figure class='code'><figcaption><span>Check a Forward Zone</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ dig @ns2.ambrose.edu +nocmd mail.ambrose.edu any +multiline +noall +answer
</span><span class='line'>mail.ambrose.edu.       10800 IN A 66.244.237.42</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Check a Reverse Zone</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ dig @ns2.ambrose.edu +nocmd 237.244.66.in-addr.arpa. any +multiline +noall +answer
</span><span class='line'>237.244.66.in-addr.arpa. 10800 IN SOA ns1.ambrose.edu. helpdesk.ambrose.edu. (
</span><span class='line'>                                2013071201 ; serial
</span><span class='line'>                                604800     ; refresh (1 week)
</span><span class='line'>                                86400      ; retry (1 day)
</span><span class='line'>                                2419200    ; expire (4 weeks)
</span><span class='line'>                                604800     ; minimum (1 week)
</span><span class='line'>                                )
</span><span class='line'>237.244.66.in-addr.arpa. 10800 IN NS ns1.
</span><span class='line'>
</span><span class='line'>$ dig @ns2.ambrose.edu +nocmd 42.237.244.66.in-addr.arpa. any +multiline +noall +answer
</span><span class='line'>42.237.244.66.in-addr.arpa. 10800 IN PTR mail.ambrose.edu.</span></code></pre></td></tr></table></div></figure>


<h2>Get a second opinion</h2>

<p>There are quite a few automated tests that will check the responses from your nameservers, and ensure everything is in working order. I found that <a href="http://dnscheck.pingdom.com/">Pingdom</a>, the <a href="http://dnscheck.iis.se/">Swedish Internet Infrastructure Foundation</a>, and <a href="http://www.intodns.com/">IntoDNS</a> were extremely helpful.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Testing, 1 2 3. This is a test.]]></title>
    <link href="http://spenserj.com/blog/2013/07/12/testing-1-2-3-this-is-a-test/"/>
    <updated>2013-07-12T10:54:00-06:00</updated>
    <id>http://spenserj.com/blog/2013/07/12/testing-1-2-3-this-is-a-test</id>
    <content type="html"><![CDATA[<p>I&rsquo;ve decided to give <a href="http://octopress.org/">Octopress</a> a chance, and so far I&rsquo;m enjoying it far more than <a href="https://drupal.org/">Drupal</a>. While a content management framework is great, I&rsquo;ve always found that there is far too much bloat for it to be used as a blogging platform. On top of that, <a href="http://daringfireball.net/projects/markdown/">Markdown</a> is a fantastic language, and being able to easily write beautiful code through it is extremely enticing.</p>

<p>Only time will tell if this results in me posting more frequently, but I&rsquo;m optimistic.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Building the Science Lab]]></title>
    <link href="http://spenserj.com/blog/2013/05/14/building-the-science-lab/"/>
    <updated>2013-05-14T19:53:00-06:00</updated>
    <id>http://spenserj.com/blog/2013/05/14/building-the-science-lab</id>
    <content type="html"><![CDATA[<p>There have been a significant number of bugs with the <a href="http://pecl.php.net/package/APC">Alternative PHP Cache (APC)</a> over the past year, causing me to pass over PHP updates for fear of segfaults, however that has finally come to an end. APC is still just as buggy, but <a href="https://wiki.php.net/rfc/optimizerplus">PHP 5.5</a> will be bringing <a href="http://pecl.php.net/package/ZendOpcache">Zend OPCache</a> to the core, so I&rsquo;ve decided to transition early and configure the PECL package. As Zend OPCache does not come with a User Cache, I decided to set up Memcache on the <a href="https://ambrose.edu/">Ambrose University College</a> Drupal website, and was seeing benchmarks of around 65 requests per second (up from 30-35 req/sec with APC only).</p>

<p>As <a href="https://github.com/krakjoe/apcu">APCu</a> (userland caching) continues to branch from the crusty old APC branch, and the old APC Opcaching code is remove, I&rsquo;ll be running a few tests to see whether APCu can bring more to the table than Memcache can, as I have no need for the distributed functionality that Memcache provides.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Spring Cleaning]]></title>
    <link href="http://spenserj.com/blog/2013/05/14/spring-cleaning/"/>
    <updated>2013-05-14T13:39:00-06:00</updated>
    <id>http://spenserj.com/blog/2013/05/14/spring-cleaning</id>
    <content type="html"><![CDATA[<p>I&rsquo;ve decided to wipe out a few years worth of hastily written blog posts and start fresh. Fitting, given that I&rsquo;m also switching to <a href="http://spenserj.com">SpenserJ.com</a> as my domain name, after waiting for it to expire for the better part of two years. My vision is for this site to be a landing zone for the various ideas and tweaks that come to me every week.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Upgrading a Moodle 1.9 Block to 2.0]]></title>
    <link href="http://spenserj.com/blog/2011/04/14/upgrading-a-moodle-1-dot-9-block-to-2-dot-0/"/>
    <updated>2011-04-14T12:55:00-06:00</updated>
    <id>http://spenserj.com/blog/2011/04/14/upgrading-a-moodle-1-dot-9-block-to-2-dot-0</id>
    <content type="html"><![CDATA[<p>I recently went through the process of upgrading a Moodle 1.9 block for Panopto, to support Moodle 2.0, which came out in January. As Moodle 2.0 is a huge rewrite, and is still fairly fresh, there is very little documentation on what changes need to be made, or even what functions are deprecated and need replacing. In order to upgrade the plugin at Ambrose University College, I read through multiple core classes, and compared functions in 1.9 to 2.0. In order to make things easier for myself in the future, and for anyone else upgrading a block, I have documented my changes.</p>

<!-- more -->


<p>Language strings must be listed in <code>blockname/lang/en/block_blockname.php</code>, and one of the strings must be the plugin name:</p>

<figure class='code'><figcaption><span>blockname/lang/en/block_blockname.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nv">$string</span><span class="p">[</span><span class="s1">&#39;pluginname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Epic Block&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$string</span><span class="p">[</span><span class="s1">&#39;name_of_string&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;English version of string&#39;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The version has been moved from <code>blockname/blocks_blockname.php</code> to <code>blockname/version.php</code>. The format of the version remains the same (yyyymmdd00, where 00 can increment if you release multiple patches on a single day)</p>

<figure class='code'><figcaption><span>blockname/version.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nv">$plugin</span><span class="o">-&gt;</span><span class="na">version</span> <span class="o">=</span> <span class="mi">2011040800</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The function for checking if the current user is a teacher who can edit the current course has changed, as have a few others, so use this as a base, and read through the core classes for the correct values.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">if</span><span class="p">(</span><span class="nx">isteacheredit</span><span class="p">(</span><span class="nv">$COURSE</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">))</span> <span class="p">{</span>
</span></code></pre></td></tr></table></div></figure>


<p>has now become</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$context</span> <span class="o">=</span> <span class="nx">get_context_instance</span><span class="p">(</span><span class="nx">CONTEXT_COURSE</span><span class="p">,</span> <span class="nv">$COURSE</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">);</span>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="nx">has_capability</span><span class="p">(</span><span class="s1">&#39;moodle/course:update&#39;</span><span class="p">,</span> <span class="nv">$context</span><span class="p">))</span> <span class="p">{</span>
</span></code></pre></td></tr></table></div></figure>


<p>Stylesheets are now in <code>style.css</code>, instead of <code>style.php</code>.</p>

<p>Configuration files have also changed, as <code>config_instance.html</code> has been replaced with <code>edit_form.php</code> (below), and <code>config_global.html</code> has been replaced with <code>settings.php</code> (below <code>edit_form.php</code>).</p>

<figure class='code'><figcaption><span>edit_form.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="k">require_once</span><span class="p">(</span><span class="s2">&quot;lib/panopto_data.php&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">block_panopto_edit_form</span> <span class="k">extends</span> <span class="nx">block_edit_form</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">protected</span> <span class="k">function</span> <span class="nf">specific_definition</span><span class="p">(</span><span class="nv">$mform</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">global</span> <span class="nv">$COURSE</span><span class="p">,</span> <span class="nv">$CFG</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Construct the Panopto data proxy object</span>
</span><span class='line'>    <span class="nv">$panopto_data</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">panopto_data</span><span class="p">(</span><span class="nv">$COURSE</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$panopto_data</span><span class="o">-&gt;</span><span class="na">servername</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$panopto_data</span><span class="o">-&gt;</span><span class="na">instancename</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$panopto_data</span><span class="o">-&gt;</span><span class="na">applicationkey</span><span class="p">))</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="nv">$mform</span><span class="o">-&gt;</span><span class="na">addElement</span><span class="p">(</span><span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="s1">&#39;configheader&#39;</span><span class="p">,</span> <span class="s1">&#39;Select the Panopto CourseCast course to display in this block.&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">$params</span><span class="o">-&gt;</span><span class="na">course_ids</span> <span class="o">=</span> <span class="nv">$COURSE</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>
</span><span class='line'>      <span class="nv">$params</span><span class="o">-&gt;</span><span class="na">return_url</span> <span class="o">=</span> <span class="nb">urlencode</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REQUEST_URI&#39;</span><span class="p">]);</span>
</span><span class='line'>      <span class="nv">$query_string</span> <span class="o">=</span> <span class="nb">http_build_query</span><span class="p">(</span><span class="nv">$params</span><span class="p">);</span>
</span><span class='line'>      <span class="nv">$provision_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">$CFG-&gt;wwwroot</span><span class="s2">/blocks/panopto/provision_course.php?&quot;</span> <span class="o">.</span> <span class="nv">$query_string</span><span class="p">;</span>
</span><span class='line'>      <span class="nv">$course_list</span> <span class="o">=</span> <span class="nv">$panopto_data</span><span class="o">-&gt;</span><span class="na">get_course_options</span><span class="p">(</span><span class="nv">$provision_url</span><span class="p">);</span>
</span><span class='line'>      <span class="nv">$mform</span><span class="o">-&gt;</span><span class="na">addElement</span><span class="p">(</span><span class="s1">&#39;selectgroups&#39;</span><span class="p">,</span> <span class="s1">&#39;config_course&#39;</span><span class="p">,</span> <span class="s1">&#39;Course&#39;</span><span class="p">,</span> <span class="nv">$course_list</span><span class="p">[</span><span class="s1">&#39;courses&#39;</span><span class="p">]);</span>
</span><span class='line'>      <span class="nv">$mform</span><span class="o">-&gt;</span><span class="na">setDefault</span><span class="p">(</span><span class="s1">&#39;config_course&#39;</span><span class="p">,</span> <span class="nv">$course_list</span><span class="p">[</span><span class="s1">&#39;selected&#39;</span><span class="p">]);</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="nv">$mform</span><span class="o">-&gt;</span><span class="na">addElement</span><span class="p">(</span><span class="s1">&#39;static&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Cannot configure block instance: Global configuration incomplete. Please contact your system administrator.&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>settings.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="nb">defined</span><span class="p">(</span><span class="s1">&#39;MOODLE_INTERNAL&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="k">die</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nv">$ADMIN</span><span class="o">-&gt;</span><span class="na">fulltree</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nv">$settings</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">admin_setting_configtext</span><span class="p">(</span><span class="s1">&#39;block_panopto_instance_name&#39;</span><span class="p">,</span> <span class="s1">&#39;Moodle Instance Name&#39;</span><span class="p">,</span>
</span><span class='line'>                       <span class="s1">&#39;This value is prefixed before usernames and course-names in Panopto.&#39;</span><span class="p">,</span> <span class="s1">&#39;moodle&#39;</span><span class="p">,</span> <span class="nx">PARAM_TEXT</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$settings</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">admin_setting_configtext</span><span class="p">(</span><span class="s1">&#39;block_panopto_server_name&#39;</span><span class="p">,</span> <span class="s1">&#39;Panopto Server Hostname&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">PARAM_TEXT</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$settings</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">admin_setting_configtext</span><span class="p">(</span><span class="s1">&#39;block_panopto_application_key&#39;</span><span class="p">,</span> <span class="s1">&#39;Application Key&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">PARAM_TEXT</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$link</span> <span class="o">=</span><span class="s1">&#39;&lt;a href=&quot;&#39;</span><span class="o">.</span><span class="nv">$CFG</span><span class="o">-&gt;</span><span class="na">wwwroot</span><span class="o">.</span><span class="s1">&#39;/blocks/panopto/provision_course.php&quot;&gt;Add Moodle courses to Panopto CourseCast&lt;/a&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$settings</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">admin_setting_heading</span><span class="p">(</span><span class="s1">&#39;block_panopto_add_courses&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$link</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>There are many more changes that occurred, and this post is only the tip of the iceberg, so post a comment if you can&rsquo;t find the replacement for a deprecated function, and I&rsquo;ll do my best to help you out. If you want to see a legitimate commit for the changes that I made to upgrade a 1.9 block to a working 2.0 block, take a look at <a href="https://github.com/SpenserJ/Moodle2-Panopto/commit/ca893577b7d34adbeca6e95f5fe2f54194d488a3">this commit</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Fixing the Blackbaud NetCommunity Login Form]]></title>
    <link href="http://spenserj.com/blog/2011/04/14/fixing-the-blackbaud-netcommunity-login-form/"/>
    <updated>2011-04-14T12:52:00-06:00</updated>
    <id>http://spenserj.com/blog/2011/04/14/fixing-the-blackbaud-netcommunity-login-form</id>
    <content type="html"><![CDATA[<p>Blackbaud NetCommunity 6.15 has a bug in the login form, where tabbing onto the &ldquo;Remember Me&rdquo; field and pressing enter (normal functionality to submit a form) will take you back to the login form, with your username filled in, but no password or error. This is due to the fact that javascript is being (poorly) added directly to the HTML tags, instead of writing a simple, unobtrusive javascript function, that targets all fields on the form.</p>

<p>To remedy this, add a JS file to any layout that may contain a login field, and add this code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">((</span><span class="nx">$loginForm</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.LoginFormTable&#39;</span><span class="p">)).</span><span class="nx">length</span> <span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;input[type!=submit]&#39;</span><span class="p">,</span> <span class="nx">$loginForm</span><span class="p">).</span><span class="nx">keypress</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">((</span><span class="nx">e</span><span class="p">.</span><span class="nx">which</span> <span class="o">&amp;</span><span class="nx">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="nx">amp</span><span class="p">;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">which</span> <span class="o">==</span> <span class="mi">13</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">&amp;</span><span class="nx">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="nx">amp</span><span class="p">;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">ke</span> <span class="o">==</span> <span class="mi">13</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;input[type=submit]&#39;</span><span class="p">,</span> <span class="nx">$loginForm</span><span class="p">).</span><span class="nx">click</span><span class="p">();</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Adding iFrames to Blackbaud NetCommunity <= 6.15.70]]></title>
    <link href="http://spenserj.com/blog/2011/03/25/adding-iframes-to-blackbaud-netcommunity/"/>
    <updated>2011-03-25T12:47:00-06:00</updated>
    <id>http://spenserj.com/blog/2011/03/25/adding-iframes-to-blackbaud-netcommunity</id>
    <content type="html"><![CDATA[<p>Version 6.15 of Blackbaud NetCommunity consisted of many large changes to how BBNC works, one of which was the editor. In this update, Blackbaud moved from BBCuteEditor to TinyMCE (a great decision IMO, as TinyMCE is one of the most popular WYSIWYG editors). Sadly, patch 70 and below do not support iFrames, even if you have the iFrame set as a &ldquo;Safe HTML Tag&rdquo; in the settings. Blackbaud is working on a patch for this (patch 71 to be exact), however they do not have an ETA for it yet.</p>

<!-- more -->


<p>We have always had maps embedded in our website, to help visitors find us, and we recently decided to also embed a few YouTube videos. Due to the change in 6.15 however, we could no longer do so, and I went on a hunt to find the key to the iFrame kingdom. After using the find-in-file feature of Windows, and coming up short on anything, I wrote a quick little script to rewrite the editor initialization code, remove existing editors, and reinitialize them, with the iframe allowed. It wasn&rsquo;t the most elegant solution, however it worked for the interm, as I waited for Blackbaud to release P71. While implementing it however, I stumbled across the original initialization code, and instantly threw what I had written out.</p>

<p>Since it took a while for me to find this, I figure it may come in handy for anyone else that needs to add iFrames to TinyMCE in Blackbaud NetCommunity, or for anyone wanting to tweak the editor in the future.</p>

<p>The file that you&rsquo;ll want to edit is <code>{NetCommunity}/admin/HTMLEditorControl2.ascx</code>. For adding iFrames to the valid elements, I changed:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;appfx:HtmlEditorSetting Name="extended_valid_elements" Value="'style[dir&lt;ltr?rtl|lang|media|title|type]</span></code></pre></td></tr></table></div></figure>


<p>to:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;appfx:HtmlEditorSetting Name="extended_valid_elements" Value="'iframe[src|width|height|name|align],style[dir&lt;ltr?rtl|lang|media|title|type]</span></code></pre></td></tr></table></div></figure>


<p>Save the file, and refresh the editor, and you should now be able to insert iFrames into your page. Through this file, you can also change the theme that is used, disable certain toolbar buttons, and adjust anything else that is in the <a href="http://tinymce.moxiecode.com/wiki.php/Configuration">TinyMCE Configuration</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Creating a Blackbaud NetCommunity Custom Part]]></title>
    <link href="http://spenserj.com/blog/2011/02/23/creating-a-blackbaud-netcommunity-custom-part/"/>
    <updated>2011-02-23T18:32:00-07:00</updated>
    <id>http://spenserj.com/blog/2011/02/23/creating-a-blackbaud-netcommunity-custom-part</id>
    <content type="html"><![CDATA[<p>I&rsquo;ve recently been given the task of creating some custom plugins for NetCommunity, so we can do things like unify the design of our Faculty Biography pages at Ambrose. I have prior experience with C#, so I figured it would be a fairly simple process, once I figured out how their API works, however there is minimal documentation, and all of the tutorials online are either outdated or incomplete.</p>

<p>As such, I am going to write up a concise walkthrough for creating a NetCommunity plugin (for 6.15) using C#, from scratch, up until you have a functional part.</p>

<!-- more -->


<p>Begin by creating a new &ldquo;ASP.NET Empty Web Application&rdquo; project in Microsoft Visual Web Developer (<a href="http://cl.ly/4nce">http://cl.ly/4nce</a>). Right click on References, in the Solution Explorer, and choose Add Reference. Under the Browse tab, navigate to the Bin folder of your NetCommunity installation, and choose <code>BBNCExtensions.dll</code> (<a href="http://cl.ly/4nOt">http://cl.ly/4nOt</a>). Finally, go into the Project menu, and click <code>{ProjectName} properties</code>, and change Target framework to <code>.NET Framework 3.5</code> (under the application tab). You&rsquo;re now ready to start coding some basic functionality into your application.</p>

<p>Right click on your project in the Solution Explorer (should be the bold title at the very top), and choose <code>Add-&gt;New Item</code>. You will want to create two new <code>Web User Controls</code> named <code>Display.ascx</code> and <code>Editor.ascx</code> (<a href="http://cl.ly/4n69">http://cl.ly/4n69</a>). In Display.ascx.cs and Editor.ascx.cs, add the following &ldquo;using&rdquo; statements:</p>

<figure class='code'><figcaption><span>Display.ascx.cs and Editor.ascx.cs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">using</span> <span class="nn">BBNCExtensions</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">BBNCExtensions.Parts</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then, in <code>Display.ascx.cs</code>, change <code>System.WebUI.UserControl</code> (the class to inherit from) to <code>BBNCExtensions.Parts.CustomPartDisplayBase</code>. In <code>Editor.ascx.cs</code>, you&rsquo;ll want to change <code>System.WebUI.UserControl</code> to <code>BBNCExtensions.Parts.CustomPartEditorBase</code>. You&rsquo;ll also want to add two functions, as follow:</p>

<figure class='code'><figcaption><span>Display.ascx.cs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnLoadContent</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">public</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">OnSaveContent</span><span class="p">(</span><span class="kt">bool</span> <span class="n">bDialogIsClosing</span><span class="p">){</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Your plugin is now finished, and it is time to build it, and set it up in NetCommunity. Click build, and copy <code>bin/{ProjectName}.dll</code> to <code>{NetCommunityInstall}/Bin</code>, and copy <code>Display.ascx</code> and <code>Editor.ascx</code> (from the project root) to <code>{NetCommunityInstall}/Custom/{ProjectName}/</code>. Then open up the Custom Part settings page in NetCommunity, click <code>New custom part</code>, and give your part a name. For Display/Edit Control Source, enter <code>~\Custom\{ProjectName}\{Display|Editor}.ascx</code> (depending on which field you&rsquo;re changing), and leave <code>Supports Personalization for</code> set to <code>Not Supported</code>.</p>

<p>Save the custom part, and try creating a part, and you should see a blank editor page, and a blank display page (after you save it). Your NetCommunity plugin is now built, so give yourself a pat on the back, take a quick break, and then we&rsquo;ll add some basic functionality.</p>

<p>Every change you make will require that you update either the DLL, the ascx files, or both (depending on what you change), so lets automate that with some build events. Click the Project Menu, and then <code>{ProjectName} Properties</code>. Open the Build Events tab, and edit the Post-build event so that it reads (with obvious path adjustments):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>copy "$(ProjectDir)*.ascx"  "c:\Program Files\Blackbaud\NetCommunity\Custom\$(ProjectName)"
</span><span class='line'>copy "$(TargetDir)$(ProjectName).dll" "c:\Program Files\Blackbaud\NetCommunity\Bin"</span></code></pre></td></tr></table></div></figure>


<p>Click build, and you should see it automatically copy the three files into their appropriate directories.</p>

<p>Now to bring the plugin to life, and add some actual functionality. Right click on your project in the Solution Explorer, and choose <code>Add-&gt;Class</code>. Name it something appropriate, as this class will hold the settings for this part. Inside of the class declaration, add a public variable for every property of the part (e.g. public string name = &ldquo;&rdquo;;).</p>

<p>Open <code>Editor.ascx</code> in design mode, and add a text field (you can add labels and formatting whenever you please) for each property that you want to make editable, and set the ID to match the property name. I chose to prefix each with &ldquo;field&rdquo; to make it easier to find, which resulted in things like &ldquo;fieldEducation&rdquo; as an ID, but as long as you can keep track of each property, you can name it any proper variable name.</p>

<p>Then, go back to <code>Editor.ascx.cs</code>, and in your <code>OnSaveContent</code> function, add the following (adjusting as necessary). I&rsquo;m going to use property_class, but replace that with whatever you named the class you created above (containing your property declarations):</p>

<figure class='code'><figcaption><span>Editor.ascx.cs - OnSaveContent</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="c1">// Lets create an empty property_class variable, to save our data</span>
</span><span class='line'><span class="n">property_class</span> <span class="n">save_data</span> <span class="p">=</span> <span class="k">new</span> <span class="n">property_class</span><span class="p">();</span>
</span><span class='line'><span class="c1">// For each property that you have, add a line similar to this</span>
</span><span class='line'><span class="n">save_data</span><span class="p">.</span><span class="n">education</span> <span class="p">=</span> <span class="n">fieldEducation</span><span class="p">.</span><span class="n">Text</span><span class="p">;</span>
</span><span class='line'><span class="c1">// Now lets save all of those properties to the part</span>
</span><span class='line'><span class="k">base</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="n">SaveContent</span><span class="p">(</span><span class="n">save_data</span><span class="p">);</span>
</span><span class='line'><span class="c1">// Finally, let the browser know that everything worked, and let the window close</span>
</span><span class='line'><span class="c1">// When you add validation, return false if you find an error</span>
</span><span class='line'><span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>While still in <code>Editor.ascx.cs</code>, add the following to <code>OnLoadContent</code>, again modifying it as needed:</p>

<figure class='code'><figcaption><span>Editor.ascx.cs - OnLoadContent</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="c1">// Check if we&#39;re not updating the data (e.g. we just opened the editor)</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">Request</span><span class="p">.</span><span class="n">RequestType</span> <span class="p">!=</span> <span class="s">&quot;POST&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// Load the content from our part, as property_class</span>
</span><span class='line'>    <span class="n">property_class</span> <span class="n">get_data</span> <span class="p">=</span> <span class="k">base</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="n">GetContent</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">property_class</span><span class="p">))</span> <span class="k">as</span> <span class="n">property_class</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">// If get_data is null, this is a brand new part. If it isn&#39;t null, lets set our fields to the data</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">get_data</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Add a line like this for every property in property_class</span>
</span><span class='line'>        <span class="n">fieldEducation</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="n">get_data</span><span class="p">.</span><span class="n">education</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you build the part, and try it in NetCommunity at this point, you&rsquo;ll find that you can create and edit the part, and it will retain your changes, however it doesn&rsquo;t display your changes anywhere. To add that in, open up <code>Display.ascx</code> in design mode, and add Literal tags to your code, again, setting the ID to something logical. Then open up <code>Display.ascx.cs</code>, and add the following to your <code>Page_Load</code> function, as usual, editing it where needed:</p>

<figure class='code'><figcaption><span>Display.ascx - Page_Load</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="c1">// Load the content from our part, as property_class</span>
</span><span class='line'><span class="n">property_class</span> <span class="n">get_data</span> <span class="p">=</span> <span class="k">base</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="n">GetContent</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">property_class</span><span class="p">))</span> <span class="k">as</span> <span class="n">property_class</span><span class="p">;</span>
</span><span class='line'><span class="c1">// Has this part been saved before?</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">get_data</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// Add a line like this for every property in property_class</span>
</span><span class='line'>    <span class="n">fieldEducation</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="n">get_data</span><span class="p">.</span><span class="n">education</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you save and build your part again, you&rsquo;ll see that your properties are now being displayed as well. Congratulations on successfully building your first Blackbaud NetCommunity Custom Part.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Locking down Blackbaud NetCommunity content authoring]]></title>
    <link href="http://spenserj.com/blog/2010/12/20/locking-down-blackbaud-netcommunity-content-authoring/"/>
    <updated>2010-12-20T18:21:00-07:00</updated>
    <id>http://spenserj.com/blog/2010/12/20/locking-down-blackbaud-netcommunity-content-authoring</id>
    <content type="html"><![CDATA[<p>At Ambrose University College, we run Blackbaud NetCommunity as our CMS, and I&rsquo;ve encountered a few issues with permissions for content authors, and how the editor itself works. Over the past few weeks, in an attempt to improve the experience of both our visitors, and our content authors, I have added a few lines to our website&rsquo;s javascript file (hosted in a document part).</p>

<p>One issue we have run into is that Internet Explorer does not play nice with our CSS3 box shadows (using CSS3Pie), and will save the progressive enhancements that are loaded specifically for IE, as part of the page and/or part, for all browsers. This results in pages that have been edited using IE, showing two box shadows in CSS3 compliant browsers, and only one in IE. Since IE is to blame (and has issues with other parts of the editor), I decided to kill off support for using IE when in administration mode.</p>

<!-- more -->


<p>While I was working on my IE-proofing, one of our content authors accidentally clicked the &ldquo;Template Designer&rdquo; button, which resulted in her inserting a part on every page on the website. This is not the first time we have encountered this issue, and last time it happened, it took about two hours to fix, as changes were also made to the HTML of the template. Two lines of javascript later, and the Stylesheet editor and Template Designer buttons no longer appear. If I need to make changes, I can always go through the page finder, but changes are so infrequent that having a front-and-center button is just asking for trouble.</p>

<p>Incase you would like to implement similar &ldquo;fixes&rdquo; on your NetCommunity website, I have the code for 6.10 posted below :)</p>

<figure class='code'><figcaption><span>NetCommunity 6.10</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">$adminMenu</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#bbAdminMenuDiv&#39;</span><span class="p">,</span> <span class="nx">top</span><span class="p">.</span><span class="nb">document</span><span class="p">);</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">ieDisabledMessage</span> <span class="o">=</span> <span class="s1">&#39;In order to edit the Ambrose website, please use Firefox. IE support has been disabled due to compatibility issues.&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">browser</span><span class="p">.</span><span class="nx">msie</span> <span class="o">&amp;&amp;</span> <span class="nx">$adminMenu</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;div, table, a&#39;</span><span class="p">,</span> <span class="nx">$adminMenu</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
</span><span class='line'>    <span class="nx">$adminMenu</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">ieDisabledMessage</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">top</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;/AdminPage.aspx&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#pagecntnt_AdminToolbar_btn2, #pagecntnt_AdminToolbar_btn3&#39;</span><span class="p">,</span> <span class="nx">top</span><span class="p">.</span><span class="nb">document</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">browser</span><span class="p">.</span><span class="nx">msie</span><span class="p">)</span> <span class="p">{</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#pagecntnt_divContentPane&#39;</span><span class="p">,</span> <span class="nx">top</span><span class="p">.</span><span class="nb">document</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">ieDisabledMessage</span><span class="p">);</span> <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>As of December 22nd, we have upgraded to 6.15, and the administration menu and screens have changed. As such, I have rewritten the code, and it is also posted below</em></p>

<figure class='code'><figcaption><span>NetCommunity 6.15</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">$adminMenu</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#ctl05_bbBetaAdminMenuDiv&#39;</span><span class="p">,</span> <span class="nx">top</span><span class="p">.</span><span class="nb">document</span><span class="p">);</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">ieDisabledMessage</span> <span class="o">=</span> <span class="s1">&#39;In order to edit the Ambrose website, please use Firefox. IE support has been disabled due to compatibility issues.&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">browser</span><span class="p">.</span><span class="nx">msie</span> <span class="o">&amp;&amp;</span> <span class="nx">$adminMenu</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;ul.bb_mainMenu li:gt(0), .bb_subMenu&#39;</span><span class="p">,</span> <span class="nx">$adminMenu</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;li:first&#39;</span><span class="p">,</span> <span class="nx">$adminMenu</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&lt;h2 style=&quot;padding: 0px 12px;&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">ieDisabledMessage</span> <span class="o">+</span> <span class="s1">&#39;&lt;/h2&gt;&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">top</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;ambrose.edu/cms/&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#pagecntnt_AdminToolbar_btn1lnk, #pagecntnt_AdminToolbar_btn2lnk&#39;</span><span class="p">,</span> <span class="nx">top</span><span class="p">.</span><span class="nb">document</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">browser</span><span class="p">.</span><span class="nx">msie</span><span class="p">)</span> <span class="p">{</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#divPage&#39;</span><span class="p">,</span> <span class="nx">top</span><span class="p">.</span><span class="nb">document</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span><span class="s1">&#39;#fff&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">ieDisabledMessage</span><span class="p">);</span> <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CSS3 and Pictos]]></title>
    <link href="http://spenserj.com/blog/2010/12/17/css3-and-pictos/"/>
    <updated>2010-12-17T17:24:00-07:00</updated>
    <id>http://spenserj.com/blog/2010/12/17/css3-and-pictos</id>
    <content type="html"><![CDATA[<p>Over the past six months, I&rsquo;ve been charged with redeveloping the <a href="https://www2.ambrose.edu/">Ambrose University College</a> website, using BlackBaud NetCommunity. I worked together with the creative department (mainly focused on print media) for a new design (old one is <del><a href="https://www2.ambrose.edu/">here</a></del> offline), and with many other departments for training in content management and functionality. I&rsquo;ve learned quite a bit through the process, and grown immensely in my skills (primarily CSS and C#.Net). This post, however, is not so much about the experience I went through, as it is with the advancements I&rsquo;ve made when it comes to CSS3 replacing images, and support for it in all major browsers.</p>

<!-- more -->


<p>The initial design was thrown together over a few months, as I worked on getting content uploaded, and functionality working. It was not until two weeks ago that I was able to sit back and actually focus on making the website look good, instead of making it functional. Although I am  not a fan of certain aspects of the design, I have focused on improving what I could in it, and providing support for all browsers, including the bane of every designer/developer&hellip; Internet Explorer. During the &ldquo;throw it together to make people happy&rdquo; phase, I used plenty of images for buttons, and the designers rounded corners in all of the header images that we uploaded, however that increases their workload, and makes it harder to tweak buttons in the future (which we end up doing more than I&rsquo;d like to admit). It quickly became apparent that the website would become a time-sink for those that manage it, and a resource-hog for those that view it, if drastic measures were not taken. Which brings me to two weeks ago&hellip;</p>

<p>We have always used box-shadows on the website, as I was not willing to go through the pain of transparent PNGs in IE, however we have buttons below the <a href="https://www2.ambrose.edu/Page.aspx?pid=492">menu</a>, that were image based, and I was told that we were to add more buttons to a <a href="https://www2.ambrose.edu/Page.aspx?pid=475">few</a> <a href="https://www2.ambrose.edu/Page.aspx?pid=389">other</a> <a href="https://www2.ambrose.edu/Page.aspx?pid=548">pages</a>. Since content was 99% online, I took a look at how we could improve the load times for the website, by replacing these buttons with CSS3 buttons.</p>

<p>Just a few days earlier, I had picked up <a href="http://twitter.com/drewwilson">Drew Wilson&rsquo;s</a> <a href="http://pictos.drewwilson.com/">Pictos</a> web-font on sale, and I suggested it to my boss, so we picked up another license and I began to fiddle around with some nice buttons. Through the use of border-radius and -webkit-gradient (and others like -moz), I was able to perfectly replicate what our designer had envisioned, but without using a single image. I quickly replaced five buttons with their CSS3 counterparts, and was working on implementing them on the new pages, when I realized that they did not look very nice in Internet Explorer. In fact, they were a solid colour, and due to a glitch with <a href="http://fetchak.com/ie-css3/">IE-CSS3</a>, had rounded corners appearing 20px+ BELOW the buttons. Needless to say, certain faculty did not appreciate that their primary browser did not handle things properly, and I put some work into fixing things. After dropping <a href="http://css3pie.com/">CSS3Pie</a> into the website, in place of IE-CSS3, things started looking up. Our box-shadows were more realistic, and the corners no longer jumped around like schoolkids overdosing on sugar. With a few more tweaks, (-pie-background to add support for two-point gradients in IE), we were back in action, and IE looked <strong>almost</strong> as good as Chrome and Firefox.</p>

<p>Since we&rsquo;ve implemented these CSS3 buttons, I&rsquo;ve managed to kill off close to 1 MB of images, and we&rsquo;ve implemented mouseovers with minimal effort. When a new page is added to the website, we can also add some sidebar links, with images, without going through the longwinded process of designing new buttons, and finding icons that don&rsquo;t really match with the previous set.</p>

<p><a href="http://pictos.drewwilson.com/">Pictos</a> has already proved itself, and is well worth the money we invested in it, and I would highly suggest checking it out, if you have a few buttons that could do with a fresh new look on your website. And, as new as CSS3 is, with a bit of elbow grease (-webkit, -moz, -o, and -ms take up quite a bit of time to type out for every effect) and some fallback support (CSS3Pie for instance), you can do some gorgeous things while still supporting 99% of users.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Building your first Adium Plugin]]></title>
    <link href="http://spenserj.com/blog/2010/08/13/building-your-first-adium-plugin/"/>
    <updated>2010-08-13T16:51:00-06:00</updated>
    <id>http://spenserj.com/blog/2010/08/13/building-your-first-adium-plugin</id>
    <content type="html"><![CDATA[<p><strong>This guide is extremely outdated. It was originally authored on August 13th, 2010, and has not been updated recently.</strong></p>

<p><em>As a warning, Adium Plugins use internal Adium APIs, which sometimes change. If you build a plugin, it may break with future versions of Adium, so be prepared for some upkeep down the road, unless you want to be rude and build a great program, and then abandon it and all of its users.</em> This guide assumes that you understand the basics of Objective-C, XCode, and programming in general. If you don&rsquo;t meet one of these prerequisites, please go research the basics and then come back.</p>

<!-- more -->


<h2>Step 1: Compiling Adium</h2>

<p>Before you can start coding a plugin, you need the Adium plugin framework. To get this, download and build Adium from <a href="http://trac.adium.im/wiki/GettingNewestAdiumSource">http://trac.adium.im/wiki/GettingNewestAdiumSource</a>. Be sure to download the version that most of your plugin&rsquo;s users will be using (e.g. stable). If you cannot complete this step without googling, I would suggest learning the basics of Objective-C and XCode, among other things, first.</p>

<h2>Step 2: Creating your plugin&rsquo;s project</h2>

<p>Open the <code>New Project</code> window, choose <code>Framework &amp; Library</code>, choose <code>Bundle</code>, and set the Framework to <code>Cocoa</code>.
Right click on your Bundle under the <code>Targets</code> section of the sidebar, and choose <code>Get Info</code>. Go to the properties tab, and set the <code>Principle Class</code> to the same as your plugin name (I&rsquo;m using MyFirstAdiumPlugin). Also, set your identifier, which is normally the reverse of your domain. Since my domain is SpenserJones.com, I will use com.spenserjones.MyFirstAdiumPlugin. Finally, set the <code>Creator</code> code to <code>AdIM</code>, and confirm that the Type is <code>BNDL</code>.
Under the Build tab of the Info window, change the following settings:</p>

<table width="100%">
<tbody>
<tr><th style="text-align: center;">Setting</th><th style="text-align: center;">Value</th></tr>
<tr>
<td>Wrapper Extension</td>
<td>AdiumPlugin</td>
</tr>
<tr>
<td>Installation Directory</td>
<td>`$(HOME)/Library/Application Support/Adium 2.0/PlugIns/`</td>
</tr>
<tr>
<td>Base SDK</td>
<td>Mac OS X 10.5 (or the lowest version of Mac OS X you can set it to)</td>
</tr>
</tbody>
</table>


<p>Finally, drag <code>$(ADIUM)/build/Development/Adium.framework</code> (where $(ADIUM) is the directory where you checked out Adium) into <code>Frameworks and Libraries/Other Frameworks</code> in the sidebar of XCode. When prompted, check the <code>Copy items into destination group's folder (if needed)</code> and <code>Recursively create groups for any added folders.</code></p>

<h2>Step 3: Writing the code</h2>

<p>Click on the folder <code>Classes</code> in the left pane of the main window of XCode, and then click <code>File - New File</code> (CMD-N). Choose <code>Cocoa Class</code> and then <code>Objective-C class</code>. Leave the subclass as <code>NSObject</code>, as we will be changing this shortly. Name the file the same name as your plugin, and check the <code>Also create \*.h</code> box.
Open up <code>MyFirstAdiumPlugin.h</code>, and add an import line of <code>#import &lt;Adium/AIPlugin.h&gt;</code> and also change <code>MyFirstAdiumPlugin : NSObject</code> to <code>MyFirstAdiumPlugin : NSObject &lt;AIPlugin&gt;</code>
Create two void functions in <code>MyFirstAdiumPlugin.m</code> called installPlugin and uninstallPlugin.  After doing these steps, your code should look like:</p>

<figure class='code'><figcaption><span>MyFirstAdiumPlugin.h</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='obj-c'><span class='line'><span class="cp">#import &lt;Cocoa/Cocoa.h&gt;</span>
</span><span class='line'><span class="cp">#import &lt;Adium/AIPlugin.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">MyFirstAdiumPlugin</span> : <span class="nc">NSObject</span> <span class="o">&lt;</span><span class="n">AIPlugin</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>MyFirstAdiumPlugin.m</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='obj-c'><span class='line'><span class="cp">#import &quot;MyFirstAdiumPlugin.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">MyFirstAdiumPlugin</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">installPlugin</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">uninstallPlugin</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Before you get too excited about having coded a plugin, there is one more step. Open <code>Info.plist</code> and add the following line, replacing <code>{VERSION}</code> with the version of Adium you compiled: <code>&lt;key&gt;AIMinimumAdiumVersionRequirement&lt;/key&gt; &lt;string&gt;{VERSION}&lt;/string&gt;</code></p>

<p>As of writing this, the release version is 1.3, while the beta is 1.4. Adium 1.4 will require users to have Leopard or better, while 1.3 requires Tiger.</p>

<h2>Step 4: Bask in the glory of your first Adium plugin</h2>

<p>All that is left is to compile and install your first Adium plugin. Click build, confirm that there are no errors, and then double-click <code>MyFirstAdiumPlugin/build/Debug/MyFirstAdiumPlugin.AdiumPlugin</code> from Finder.</p>

<h2>Step 5: Add some functionality</h2>

<p>I&rsquo;d assume that you want a plugin that actually DOES something, instead of sits pretty in your plugins folder, right? Adium&rsquo;s documentation for plugin creation is fairly sparse (and always has been), however there is a map of Adium&rsquo;s API at <a href="http://trac.adium.im/wiki/MapOfAdium">http://trac.adium.im/wiki/MapOfAdium</a>, and plenty of plugins online that you can examine. Hopefully I will find time soon to write up a continuation of this guide, for adding functionality. If you use this guide to create a plugin, I&rsquo;d love it if you would share what you&rsquo;ve done in the comments below!</p>
]]></content>
  </entry>
  
</feed>
